# ServiceNow Connector - Environment Configuration
# Copy this file to .env and fill in your credentials.
# IMPORTANT: Never commit .env files — ensure .env is in your .gitignore.

# ============================================================
# Default Instance (Basic Auth)
# ============================================================
# SNOW_INSTANCE_URL=https://your-instance.service-now.com
# SNOW_AUTH_TYPE=basic
# SNOW_USERNAME=admin
# SNOW_PASSWORD=your-password
# If your password contains special characters ($, !, `, =), use base64 encoding:
# SNOW_PASSWORD_B64=bVo5b1AtRHh4QyQz
# Encode with: echo -n 'your-password' | base64

# ============================================================
# Default Instance (OAuth ROPC)
# ============================================================
# SNOW_INSTANCE_URL=https://your-instance.service-now.com
# SNOW_AUTH_TYPE=oauth_ropc
# SNOW_USERNAME=admin
# SNOW_PASSWORD=your-password
# SNOW_CLIENT_ID=your-client-id
# SNOW_CLIENT_SECRET=your-client-secret

# ============================================================
# Default Instance (OAuth Client Credentials)
# ============================================================
# SNOW_INSTANCE_URL=https://your-instance.service-now.com
# SNOW_AUTH_TYPE=oauth_client_credentials
# SNOW_CLIENT_ID=your-client-id
# SNOW_CLIENT_SECRET=your-client-secret

# ============================================================
# Named Instance Examples (prefix with alias: DEV, TEST, PROD, etc.)
# Multiple instances can coexist in the same .env file.
# ============================================================

# --- DEV Instance (OAuth Client Credentials) ---
# SNOW_DEV_INSTANCE_URL=https://dev-instance.service-now.com
# SNOW_DEV_AUTH_TYPE=oauth_client_credentials
# SNOW_DEV_CLIENT_ID=your-client-id
# SNOW_DEV_CLIENT_SECRET=your-client-secret

# --- TEST Instance (Basic Auth) ---
# SNOW_TEST_INSTANCE_URL=https://test-instance.service-now.com
# SNOW_TEST_AUTH_TYPE=basic
# SNOW_TEST_USERNAME=admin
# SNOW_TEST_PASSWORD=your-password

# --- PROD Instance (OAuth ROPC) ---
# SNOW_PROD_INSTANCE_URL=https://prod-instance.service-now.com
# SNOW_PROD_AUTH_TYPE=oauth_ropc
# SNOW_PROD_USERNAME=admin
# SNOW_PROD_PASSWORD=your-password
# SNOW_PROD_CLIENT_ID=your-client-id
# SNOW_PROD_CLIENT_SECRET=your-client-secret

# ============================================================
# Token Caching (auto-managed — do not edit manually)
# ============================================================
# When using OAuth with SNOW_ENV_FILE and SNOW_ENV_PREFIX,
# sn.sh writes cached tokens here after acquisition:
#
# SNOW_DEV_ACCESS_TOKEN=<auto-populated>
# SNOW_DEV_REFRESH_TOKEN=<auto-populated, ROPC only>
# SNOW_DEV_TOKEN_EXPIRES_AT=<auto-populated, unix timestamp>
#
# Tokens are reused across sn.sh invocations until expired.
# To disable caching, set: SNOW_TOKEN_CACHE=false

# ============================================================
# Token Cache Control
# ============================================================
# Set to "false" to disable token caching (acquire fresh token every call).
# Default: enabled (tokens cached in this file for session reuse).
# SNOW_TOKEN_CACHE=false

# ============================================================
# Calling Pattern for Token Caching
# ============================================================
# When invoking sn.sh, the caller must map SNOW_{ALIAS}_* vars to SNOW_*
# and provide SNOW_ENV_FILE + SNOW_ENV_PREFIX for write-back:
#
# while IFS= read -r line || [[ -n "$line" ]]; do
#   [[ -z "$line" || "$line" =~ ^[[:space:]]*# ]] && continue
#   name="${line%%=*}"; value="${line#*=}"; name=$(echo "$name" | xargs)
#   case "$name" in
#     SNOW_DEV_INSTANCE_URL) export SNOW_INSTANCE_URL="$value" ;;
#     SNOW_DEV_AUTH_TYPE) export SNOW_AUTH_TYPE="$value" ;;
#     SNOW_DEV_CLIENT_ID) export SNOW_CLIENT_ID="$value" ;;
#     SNOW_DEV_CLIENT_SECRET) export SNOW_CLIENT_SECRET="$value" ;;
#     SNOW_DEV_ACCESS_TOKEN) export SNOW_ACCESS_TOKEN="$value" ;;
#     SNOW_DEV_REFRESH_TOKEN) export SNOW_REFRESH_TOKEN="$value" ;;
#     SNOW_DEV_TOKEN_EXPIRES_AT) export SNOW_TOKEN_EXPIRES_AT="$value" ;;
#   esac
# done < .env
# export SNOW_ENV_FILE="$(pwd)/.env" SNOW_ENV_PREFIX="DEV"
# bash ~/.claude/skills/connect-servicenow/scripts/sn.sh <command>

# ============================================================
# IMPORTANT: Special Characters in Secrets
# ============================================================
# OAuth client secrets often contain shell metacharacters like:
#   ( ) { } ; < > ! $ ` | * ? ~
#
# Example: SNOW_DEV_CLIENT_SECRET=XN)zI7};Q<!Xgr*79)+g
#
# These WILL break if you use "source .env" in bash.
# The calling pattern above uses safe line-by-line parsing that
# handles these characters correctly. Never use "source .env".
#
# Alternative: Use base64 encoding with _B64 suffix:
#   SNOW_DEV_CLIENT_SECRET_B64=WE4pekk3fTtRPCFYZ3IqNzkpK2coaDMoKEhHP0krZHY=
#   Encode with: echo -n 'your-secret' | base64
